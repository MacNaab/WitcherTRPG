<br>
<div id="map" style="width: 80vw; height: 80vh; background: #12a0ac;"></div>
<br>
<div>
  <h6>Gestion des marqueurs:</h6>
  <div>
    <select class="custom-select" id="P6-select">
      <option value="0" selected>Ne rien faire</option>
      <option value="1">Ajouter un marqueur</option>
      <option value="2">Editer un marqueur</option>
    </select>
  </div>
  <div id="P6_aff" style="margin:15px;display: none;">
    <div id="P6_aff_1">
      <small class="form-text text-muted">Déplacer le marqueur noir où vous souhaitez placer votre marqueur</small>
    </div>
    <div id="P6_aff_2">
      <select class="custom-select" id="P6-mark">
        <option value="" disabled selected>Marqueur à éditer</option>
      </select>
    </div>
    <div class="grid-container2">
      <div>
        <small class="form-text text-muted">Coordonnées:</small>
        <input class="form-control" type="texte" id="P6-coord" placeholder="x,y">
      </div>
      <div>
        <small class="form-text text-muted">Titre du marqueur:</small>
        <input class="form-control" type="texte" id="P6-titre" placeholder="Titre">
      </div>
    </div>
    <div>
      <small class="form-text text-muted">Description du marqueur:</small>
      <textarea class="form-control" id="P6-texte" placeholder="Description"></textarea>
    </div>
    <div style="text-align: center;">
      <button class="btn btn-success" onclick="MarKMe()" type="button">Valider</button>
    </div>
  </div>
</div>

<script type="text/javascript">
  //Creating the Map
    var map = L.map('map').setView([60, 0], 0);
    // edit: (map/{z}/{x}/{y})
    L.tileLayer('htm/map/{z}/{x}/{y}.png', {
      continuousWorld: false,
      noWrap: true,  
      minZoom: 3,
      maxZoom: 5,
    }).addTo(map);
  
  var mg_aventure = L.layerGroup();
  
  JSON_data.map.groupe.forEach(e => {
    L.marker([e.x,e.y]).bindPopup(e.T).addTo(mg_aventure);    
  });
  mg_aventure.addTo(map);

        // https://github.com/pointhi/leaflet-color-markers
        var GoldIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var VioletIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var RougeIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var VertIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var OrangeIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var JauneIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var GrisIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});
        var NoirIcon = new L.Icon({iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],shadowSize: [41, 41]});

    var IconColor = [GoldIcon,VioletIcon,RougeIcon,VertIcon,OrangeIcon,JauneIcon,GrisIcon,NoirIcon]
  var mg_Alexis = L.layerGroup();
  var mg_Vincent = L.layerGroup();
  var mg_JB = L.layerGroup();
  var mg_FT = L.layerGroup();
  
  if(JSON_data.map.Alexis != undefined){
    JSON_data.map.Alexis.forEach(e => {
      L.marker([e.x,e.y],{icon:VioletIcon}).bindPopup(e.T).addTo(mg_Alexis);    
    });
    mg_Alexis.addTo(map);
  }
  if(JSON_data.map.Vincent != undefined){
    JSON_data.map.Vincent.forEach(e => {
      L.marker([e.x,e.y],{icon:VertIcon}).bindPopup(e.T).addTo(mg_Vincent);    
    });
    mg_Vincent.addTo(map);
  }
  if(JSON_data.map.JB != undefined){
    JSON_data.map.JB.forEach(e => {
      L.marker([e.x,e.y],{icon:GoldIcon}).bindPopup(e.T).addTo(mg_JB);    
    });
    mg_JB.addTo(map);
  }
  if(JSON_data.map['F.T.'] != undefined){
    JSON_data.map['F.T.'].forEach(e => {
      L.marker([e.x,e.y],{icon:RougeIcon}).bindPopup(e.T).addTo(mg_FT);    
    });
    mg_FT.addTo(map);
  }

  var overlays = {
    "Points d'intérêts de l'aventure": mg_aventure,
    "<span style='color:purple'>Points d'intérêts Alexis</span>": mg_Alexis,
    "<span style='color:green'>Points d'intérêts Vincent</span>": mg_Vincent,
    "<span style='color:#FFD700'>Points d'intérêts JB</span>": mg_JB,
    "<span style='color:red'>Points d'intérêts F.T.</span>": mg_FT,
  }               

  //Marker Group Control
  L.control.layers(null, overlays).addTo(map);

  //Coordinate Finder
  var marker = L.marker([60, 0],{draggable: true,icon:NoirIcon});
    marker.bindPopup('LatLng Marker').openPopup();
    marker.on('dragend', function(e) {
      marker.getPopup().setContent(marker.getLatLng().toString()).openOn(map);
      $("#P6-coord").val(marker.getLatLng().toString());
    });

  try{
    var i= 0;
    JSON_data.map.groupe.forEach(function(e){
      let split = e.T.split('</b>');
        let text = split[0].replace('<b>','');
      $("#P6-mark").append("<option value='"+i+"'>"+text+"</option>");
      i += 1;
    });
  } catch (error) {}

  $("#P6-select").on( "change", function() {
    if(this.value == '1'){
      marker.addTo(map);
      document.getElementById('P6_aff').style.display = "block";
      document.getElementById('P6_aff_1').style.display = "block";
      document.getElementById('P6_aff_2').style.display = "none";
    }else{
      try {map.removeLayer(marker);} catch (error) {console.log(error);}
      if(this.value == '0'){
        document.getElementById('P6_aff').style.display = "none";
      }else{
        document.getElementById('P6_aff').style.display = "block";
        document.getElementById('P6_aff_2').style.display = "block";
        document.getElementById('P6_aff_1').style.display = "none";
      }
    }
  });

  $("#P6-mark").on( "change", function() {
    $('#P6-coord').val(JSON_data.map.groupe[this.value].x+", "+JSON_data.map.groupe[this.value].y);
    let split = JSON_data.map.groupe[this.value].T.split("</b>");
      var t = split[0].replace('<b>','');
      var tt = split[1].replace('<br>','');
    $('#P6-titre').val(t);
    $('#P6-texte').val(tt);
  });
  function MarKMe(){
    if($('#P6-coord').val()=="" || $('#P6-titre').val()==""){
      var err = "";
      if($('#P6-coord').val()==""){err = "Vous devez indiquer les coordonnées du marqueur."}
      if($('#P6-titre').val()==""){err += "<br>Vous devez donner un nom au marqueur."}
      $("#toast2_C").html(err);
      $("#toast2").toast('show');
    }else{
      var e = $('#P6-select').val();
      var c = $('#P6-coord').val();
      let split = c.split(',');
        var a = split[0].replace('LatLng(','');
      var MarkCoord = {x:parseFloat(a),y:parseFloat(split[1]),T:"<b>"+$('#P6-titre').val()+"</b><br>"+$('#P6-texte').val()};
      if($("#P6-select").val() == '1'){
        if(!JSON_data.map.groupe){JSON_data.map.groupe = [];}
        JSON_data.map.groupe.push({'x':parseFloat(a),'y':parseFloat(split[1]),'T':"<b>"+$('#P6-titre').val()+"</b><br>"+$('#P6-texte').val()});
      }else{
        JSON_data.map.groupe[$("#P6-mark").val()] = MarkCoord;
      }
      tomap('Mise à jour de la carte');
    }
  }

</script>