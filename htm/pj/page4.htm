<style>
@media only screen and (min-width: 600px) {     /* Tablettes */
    .progress {
    position: absolute;
    width: 7.5%;
    height: 250px;
    opacity: 0.8;
    filter: alpha(opacity=80);
  }
  .progress-bar {
    position: absolute;
    top: 0%;  /* = PVmax - PV */
    width: 100%;
    height: 100%;  /* PV*/
  }
}
</style>

<div id="page_4">
  <br>
  <div id="P4_INFO">
    <h3>Fiche :</h3>
	<div class="grid-container3" id="P4_Stat">
	</div>
	<h6>Protection:</h6>
	<div class="grid-container3" id="P4_Prot">
	</div>	
	<div class="grid-container2" id="P4_EC">
	</div>
	<div id="P4_Bonus">
		<b style='color:red;'>Bonus: </b>
	</div>
	<div id="P4_Malus">
		<b style='color:red;'>Malus: </b>
	</div>
  </div>
  
  <br>

  <div id="barre1">
    <div class="progress">
      <div id="barre1_PV" class="progress-bar bg-danger" role="progressbar">VIE</div>
    </div>

    <div class="progress" style="right: 10%;">
      <div id="barre1_END" class="progress-bar bg-success" role="progressbar">END</div>
    </div>
  </div>
  <div class="progress" id="barre3" style="margin-bottom: 20px;">
      <div id='barre3_cl' class="progress-bar progress-bar-striped bg-danger" role="progressbar" style="width: 100%">PV</div>
      <br>
  </div>
  
  <div class="log">
    <div id="P4_LOG"></div>
  </div>
    <br>
    <div id="barre2" class="progress">
      <div id="barre2_cl" class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 100%">END</div>
    </div>

  <br>
  <div id="les_boutons_d_actions" style="border: solid;border-color: indigo;padding: 15px;">
    <div class="grid-container4" >
        <div>
          <select class="custom-select" id="P4_Caract" onchange="caract()">
            <option selected>Caractéristique</option>
            <option value="INT">Intelligence</option>
            <option value="REF">Réflexes</option>
            <option value="DEX">Dextérité</option>
            <option value="COR">Corps</option>
            <option value="VIT">Vitesse</option>
            <option value="EMP">Empathie</option>
            <option value="TEC">Technique</option>
            <option value="VOL">Volonté</option>
            <option value="CHA">Chance</option>
            <option value="10">Compt.exclusive</option>
          </select>
        </div>
        <div>
          <select class="custom-select" id="P4_Compt">
            <option selected>Compétence</option>
          </select>
        </div>
        <div>
          <input class="form-control" type="number" id="P4_Mod" placeholder="Mod.">
        </div>
        <div style="text-align: center;">
          <input type="button" class="btn btn-primary" value="Roll !" onclick="oncalculebien()">
        </div>
    </div>
    <br>
    <div class="grid-container4" >
      <div>
<div id="P4_Armes_aff">
  <select class="custom-select" id="P4_Armes">
    <option selected>Jet d'Arme</option>
  </select>
</div>
        <div style="text-align: center;">
          <input type="button" class="btn btn-primary" value="Roll !" onclick="oncalculebien2()">
        </div>
      </div>
      <div style="text-align: center;padding-top: 15px;padding-bottom: 15px;">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Corps à corps
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" style="cursor: pointer;" onclick="oncalculebien3()">Coup de poing</a>
              <a class="dropdown-item" style="cursor: pointer;" onclick="oncalculebien4()">Coup de pied</a>
            </div>
          </div>
      </div>
      <div>
        <div>
          <input class="form-control" type="number" id="P4_dé_x" placeholder="Dé à X faces">
        </div>
        <div style="text-align: center;">
          <input type="button" class="btn btn-primary" value="Roll !" onclick="oncalculebien5()">
        </div>
      </div>
      <div style="text-align: center;padding-top: 15px;padding-bottom: 15px;">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButtonConcentration" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Indice
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButtonConcentration" style="cursor: pointer;">
            <a class="dropdown-item" onclick="calcul_effet(0,this.textContent)">Analyse de preuves</a>
            <a class="dropdown-item" onclick="calcul_effet(1,this.textContent)">Analyse des transactions</a>
            <a class="dropdown-item" onclick="calcul_effet(2,this.textContent)">Décryptage</a>
            <a class="dropdown-item" onclick="calcul_effet(3,this.textContent)">Examen d'une scène</a>
            <a class="dropdown-item" onclick="calcul_effet(4,this.textContent)">Examen de cadavre</a>
            <a class="dropdown-item" onclick="calcul_effet(5,this.textContent)">Filature</a>
            <a class="dropdown-item" onclick="calcul_effet(6,this.textContent)">Interrogatoire</a>
            <a class="dropdown-item" onclick="calcul_effet(7,this.textContent)">Investigation mystique</a>
            <a class="dropdown-item" onclick="calcul_effet(8,this.textContent)">Pistage</a>
            <a class="dropdown-item" onclick="calcul_effet(9,this.textContent)">Recherches</a>
            <a class="dropdown-item" onclick="calcul_effet(10,this.textContent)">Rumeurs</a>
          </div>
        </div>
      </div>
    </div>
    <div id="P4_magie_aff"></div>
  </div>
  <br>


  <br>
  <div style="text-align: center;">
    <a id="P4_TTS" class="btn btn-info btn-lg" href="" target="_blank" title="Ouvir le TTS dans un nouvel onglet">
      <svg class="bi bi-aspect-ratio-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.5 2A1.5 1.5 0 000 3.5v9A1.5 1.5 0 001.5 14h13a1.5 1.5 0 001.5-1.5v-9A1.5 1.5 0 0014.5 2h-13zm1 2a.5.5 0 00-.5.5v3a.5.5 0 001 0V5h2.5a.5.5 0 000-1h-3zm11 8a.5.5 0 00.5-.5v-3a.5.5 0 00-1 0V11h-2.5a.5.5 0 000 1h3z" clip-rule="evenodd"/></svg>
    </a>
  </div>
  <div style="text-align: center; margin-left: auto;margin-right: auto;cursor: pointer;">
    <br><br>
    <div>
      <img title="Ouvrir l'image dans un nouvel onglet" class="img_cool" id="P4_img" onclick='window.open(this.src)' src="https://cdn.discordapp.com/attachments/697703780510203954/751147796178141275/The_Witcher_TRPG.png">
    </div>
  </div>
</div>

<script>
  effets();
  if(JSON_data){
    if(JSON_data.TTS != undefined){document.getElementById("P4_TTS").href = JSON_data.TTS;}
    if(JSON_data.image != undefined){document.getElementById("P4_img").src = JSON_data.image;}
  }
if(!JSON_FICHE.Relance){JSON_FICHE.Relance = JSON_FICHE.CHA;}
if(!JSON_FICHE.PP){JSON_FICHE.PP = 0;}
$('#P4_Stat').append("<div>Argent: "+JSON_FICHE.Or+" couronnes</div>");
$('#P4_Stat').append("<div>Point de Chance: "+JSON_FICHE.Relance+"</div>");
$('#P4_Stat').append("<div>Réputation: "+JSON_FICHE.Réput+"</div>");
$('#P4_Stat').append("<div>PP: "+JSON_FICHE.PP+"</div>");
$('#P4_Stat').append("<div>PS: "+JSON_FICHE.PS+"/"+JSON_FICHE.Caractéristique.PS+"</div>");
  document.getElementById('barre1_PV').style.height = Math.round(Number(JSON_FICHE.PS)/Number(JSON_FICHE.Caractéristique.PS)*100)+"%";
  document.getElementById('barre3_cl').style.width = Math.round(Number(JSON_FICHE.PS)/Number(JSON_FICHE.Caractéristique.PS)*100)+"%";
$('#P4_Stat').append("<div>END: "+JSON_FICHE.END+"/"+JSON_FICHE.Caractéristique.END+"</div>");
  document.getElementById('barre1_END').style.height = Math.round(Number(JSON_FICHE.END)/Number(JSON_FICHE.Caractéristique.END)*100)+"%";
  document.getElementById('barre2_cl').style.width = Math.round(Number(JSON_FICHE.END)/Number(JSON_FICHE.Caractéristique.END)*100)+"%";
$('#P4_Stat').append("<div>Concentration: "+JSON_FICHE.Caractéristique.Concentration+"</div>");
if(JSON_FICHE.Caractéristique.VIG != undefined){
		var VIG = Number(JSON_FICHE.Caractéristique.VIG);
      if(Effet.VIG){VIG = Number(VIG)+Number(Effet.VIG);}
      try {
        JSON_FICHE.Inventaire.Arme.forEach(function(v){
          let split = v.Effet.split('Focus');
          if(split.length > 1){
            let sp1 = split[1].split(')');
            let sp2 = sp1[0].split('(');
              VIG += Number(sp2[1]);
          }
        });
      } catch (error) {console.log(error);}
		$('#P4_Stat').append("Vigeur: "+VIG);
	}
	var Prot_Tê = 0;
	var Prot_To = 0;
	var Prot_J = 0;
	var VE = 0;
	var Poids = 0;
if(JSON_FICHE.Inventaire.Armure != undefined){
	JSON_FICHE.Inventaire.Armure.forEach(function(e){
		e.Type.forEach(function(f){
			if(f == "Tête"){
        if(Prot_Tê == 0){
          Prot_Tê += Number(e.PA);
        }else{
          if(e.PA > Prot_Tê){var N = e.PA;var N1 = Prot_Tê;}else{var N = Prot_Tê;var N1 = e.PA;}
          var B = Superposition(Number(Number(N)-Number(N1)));
          Prot_Tê = Number(Number(N)+Number(B));
        }
      }
			if(f == "Torse"){
        if(Prot_To == 0){
          Prot_To += Number(e.PA);
        }else{
          if(e.PA > Prot_To){var N = e.PA;var N1 = Prot_To;}else{var N = Prot_To;var N1 = e.PA;}
          var B = Superposition(Number(Number(N)-Number(N1)));
          Prot_To = Number(Number(N)+Number(B));
        }
      }
			if(f == "Jambe"){
        if(Prot_J == 0){
          Prot_J += Number(e.PA);
        }else{
          if(e.PA > Prot_J){var N = e.PA;var N1 = Prot_J;}else{var N = Prot_J;var N1 = e.PA;}
          var B = Superposition(Number(Number(N)-Number(N1)));
          Prot_J = Number(Number(N)+Number(B));
        }
      }
		});
		VE += Number(e.VE);
		Poids += Number(e.Poids);
	});
}
function Superposition(e){
  if(e <= 4){
    return 5;
  }else if(e <= 8){
    return 4;
  }else if(e <= 14){
    return 3;
  }else if(e <= 20){
    return 2;
  }else{
    return 0;
  }
}
if(JSON_FICHE.Inventaire.Arme != undefined){
	JSON_FICHE.Inventaire.Arme.forEach(function(e){
		Poids += Number(e.Poids);
		$('#P4_Armes').append('<option value="'+e.Nom+'">'+e.Nom+'</option>');		
	});
}
if(JSON_FICHE.Inventaire.Autre != undefined){
	JSON_FICHE.Inventaire.Autre.forEach(function(e){Poids += Number(e.Poids)*Number(e.Qtt);});
}
if(JSON_FICHE.Inventaire.Schéma != undefined){
	JSON_FICHE.Inventaire.Schéma.forEach(function(e){Poids += Number(e.Poids);});
}
if(JSON_FICHE.Inventaire.Projectile != undefined){
	JSON_FICHE.Inventaire.Projectile.forEach(function(e){Poids += Number(e.Poids)*Number(e.Qtt);});
}

if(Effet.PA){
  Prot_Tê += Number(Effet.PA);
	Prot_To += Number(Effet.PA);
	Prot_J += Number(Effet.PA);
}

$('#P4_Prot').append("<div>Tête: "+Prot_Tê+"</div>");
$('#P4_Prot').append("<div>Torse: "+Prot_To+"</div>");
$('#P4_Prot').append("<div>Jambes: "+Prot_J+"</div>");

$('#P4_EC').append("<div>Encombrement: "+Poids.toFixed(2)+"Kg /"+JSON_FICHE.Caractéristique.ENC+"</div>");
$('#P4_EC').append("<div>Encombrement d'armure: "+VE+"</div>");

if(JSON_FICHE.Effet){
  if(JSON_FICHE.Effet.Bonus != undefined){$('#P4_Bonus').append(JSON_FICHE.Effet.Bonus);}
	if(JSON_FICHE.Effet.Malus != undefined){$('#P4_Malus').append(JSON_FICHE.Effet.Malus);}
}

$("#P4_LOG").html(log_backup);

function caract(){
$('#P4_Compt').empty().append('<option selected="selected" value="0">Aucune compétence</option>');
if(P4_Caract.value == "INT"){ // INT
  $('#P4_Compt')
  .append('<option value="Connaissance de la rue">Connaissance de la rue</option><option value="Connaissance des monstres">Connaissance des monstres</option><option value="Déduction">Déduction</option><option value="Éducation">Éducation</option><option value="Enseignement">Enseignement</option><option value="Étiquette">Étiquette</option><option value="Langue ancienne">Langue ancienne</option><option value="Langue commune">Langue commune</option><option value="Langue naine">Langue naine</option><option value="Négoce">Négoce</option><option value="Survie">Survie</option><option value="Tactique">Tactique</option><option value="Vigilance">Vigilance</option>');
}
if(P4_Caract.value == "REF"){ // REF
  $('#P4_Compt')
  .append('<option value="Bagarre">Bagarre</option><option value="Bâton/Lance">Bâton/Lance</option><option value="Équitation">Équitation</option><option value="Escrime">Escrime</option><option value="Esquive/Évasion">Esquive/Évasion</option><option value="Lames courtes">Lames courtes</option><option value="Mêlée">Mêlée</option><option value="Navigation">Navigation</option>');
}
if(P4_Caract.value == "DEX"){ // DEX
  $('#P4_Compt')
  .append('<option value="Adresse">Adresse</option><option value="Arbalète">Arbalète</option><option value="Archerie">Archerie</option><option value="Athlétisme">Athlétisme</option><option value="Furtivité">Furtivité</option>');
}
if(P4_Caract.value == "COR"){ // Corps
  $('#P4_Compt')
  .append('<option value="Physique">Physique</option><option value="Résilience">Résilience</option>');
}
if(P4_Caract.value == "EMP"){ // EMP
  $('#P4_Compt').append('<option value="Beaux-arts">Beaux-arts</option><option value="Charisme">Charisme</option><option value="Commandement">Commandement</option><option value="Duperie">Duperie</option><option value="Jeu">Jeu</option><option value="Persuasion">Persuasion</option><option value="Psychologie">Psychologie</option><option value="Représentation">Représentation</option><option value="Séduction">Séduction</option><option value="Stylisme">Stylisme</option>');
}
if(P4_Caract.value == "TEC"){ // TEC
  $('#P4_Compt').append('<option value="Alchimie">Alchimie</option><option value="Artisanat">Artisanat</option><option value="Contrefaçon">Contrefaçon</option><option value="Crochetage">Crochetage</option><option value="Déguisement">Déguisement</option><option value="Fabrication de pièges">Fabrication de pièges</option><option value="Premiers soins">Premiers soins</option>');
}
if(P4_Caract.value == "VOL"){ // VOL
  $('#P4_Compt')
  .append('<option value="Courage">Courage</option><option value="Envoûtement">Envoûtement</option><option value="Incantation">Incantation</option><option value="Intimidation">Intimidation</option><option value="Résistance à la contrainte">Résistance à la contrainte</option><option value="Résistance à la magie">Résistance à la magie</option><option value="Rituels">Rituels</option>');
}
if(P4_Caract.value == "10"){ // PRO
  JSON_FICHE.Compétences.forEach(function(e){
	if(e.P == "true"){
		$('#P4_Compt').append('<option value="'+e.Nom+'">'+e.Nom+'</option>');
	}
  });
}
}
</script>