<div id="page_4">
  <br>
  <div id="P4_INFO">
    <h3>Fiche :</h3>
	<div class="grid-container3" id="P4_Stat">
	</div>
	<h6>Protection:</h6>
	<div class="grid-container3" id="P4_Prot">
	</div>	
	<div class="grid-container2" id="P4_EC">
	</div>
	<div id="P4_Bonus">
		<b style='color:red;'>Bonus: </b>
	</div>
	<div id="P4_Malus">
		<b style='color:red;'>Malus: </b>
	</div>
  </div>
  
  <br>

  <div id="barre1">
    <div class="progress">
      <div id="barre1_PV" class="progress-bar bg-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100">VIE</div>
    </div>

    <div class="progress" style="right: 10%;">
      <div id="barre1_END" class="progress-bar bg-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">END</div>
    </div>
  </div>
  <div class="progress" id="barre3" style="margin-bottom: 20px;">
      <div id='barre3_cl' class="progress-bar progress-bar-striped bg-danger" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">PV</div>
      <br>
  </div>
  
  <div class="log">
    <div id="P4_LOG"><i>Début de l'aventure...</i></div>
  </div>
    <br>
    <div id="barre2" class="progress">
      <div class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">END</div>
    </div>

  <br>
  <div id="les_boutons_d_actions" style="border: solid;border-color: indigo;padding: 15px;">
    <br>
    <div class="container" >
      <div class="row">
        <div class="col-sm">
          <select class="custom-select" id="P4_Caract" onchange="caract()">
            <option selected>Caractéristique</option>
            <option value="INT">Intelligence</option>
            <option value="REF">Réflexes</option>
            <option value="DEX">Dextérité</option>
            <option value="COR">Corps</option>
            <option value="VIT">Vitesse</option>
            <option value="EMP">Empathie</option>
            <option value="TEC">Technique</option>
            <option value="VOL">Volonté</option>
            <option value="CHA">Chance</option>
            <option value="10">Compt.exclusive</option>
          </select>
        </div>
        <div class="col-sm">
          <select class="custom-select" id="P4_Compt">
            <option selected>Compétence</option>
          </select>
        </div>
        <div class="col-sm">
          <input class="form-control" type="number" id="P4_Mod" placeholder="Mod.">
        </div>
        <div class="col-sm" style="text-align: center;">
          <input type="button" class="btn btn-primary" value="Roll !" onclick="oncalculebien()">
        </div>
      </div>
    </div>
    <br>
    <div class="container" >
      <div class="row">
<div id="P4_Armes_aff">
        <div class="col">
          <select class="custom-select" id="P4_Armes">
            <option selected>Jet d'Arme</option>
          </select>
        </div>
</div>
        <div class="col" style="text-align: center;">
          <input type="button" class="btn btn-primary" value="Roll !" onclick="oncalculebien2()">
        </div>

        <div class="col-md" style="text-align: center;padding-top: 15px;padding-bottom: 15px;">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Corps à corps
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" onclick="oncalculebien3()">Coup de poing</a>
              <a class="dropdown-item" onclick="oncalculebien4()">Coup de pied</a>
            </div>
          </div>
        </div>

        <div class="col">
          <input class="form-control" type="number" id="P4_dé_x" placeholder="Dé à X faces">
        </div>
        <div class="col" style="text-align: center;">
          <input type="button" class="btn btn-primary" value="Roll !" onclick="oncalculebien5()">
        </div>
      </div>
    </div>
    <div id="P4_magie_aff"></div>
  </div>
  <br>


  <br>
  <div style="text-align: center;">
    <button class="btn btn-info btn-lg"  onclick='window.open("https://www.owlbear.rodeo/")' title="Ouvir le TTS dans un nouvel onglet"><svg class="bi bi-aspect-ratio-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M1.5 2A1.5 1.5 0 000 3.5v9A1.5 1.5 0 001.5 14h13a1.5 1.5 0 001.5-1.5v-9A1.5 1.5 0 0014.5 2h-13zm1 2a.5.5 0 00-.5.5v3a.5.5 0 001 0V5h2.5a.5.5 0 000-1h-3zm11 8a.5.5 0 00.5-.5v-3a.5.5 0 00-1 0V11h-2.5a.5.5 0 000 1h3z" clip-rule="evenodd"/></svg></button>
  </div>
  <div>
    <div style="text-align: center;"><a id="jdr0" target="_blank"></a></div>
  </div>
<div style="text-align: center; margin-left: auto;margin-right: auto;cursor: pointer;">
  <br><br>
  <div id="P4_img">
    <img title="Ouvrir l'image dans un nouvel onglet" class="img_cool" id="mon_image_cool" onclick='window.open(this.src)' src="https://cdn.discordapp.com/attachments/697703780510203954/751147796178141275/The_Witcher_TRPG.png">
  </div>
</div>
</div>

<script>
if(!JSON_FICHE.Relance){JSON_FICHE.Relance = JSON_FICHE.CHA;}
$('#P4_Stat').append("<div>Argent: "+JSON_FICHE.Or+" couronnes</div>");
$('#P4_Stat').append("<div>Relance: "+JSON_FICHE.Relance+" dé</div>");
$('#P4_Stat').append("<div>Réputation: "+JSON_FICHE.Réput+"</div>");
$('#P4_Stat').append("<div>PP: "+JSON_FICHE.PP+"</div>");
$('#P4_Stat').append("<div>PS: "+JSON_FICHE.PS+"/"+JSON_FICHE.Caractéristique.PS+"</div>");
$('#P4_Stat').append("<div>END: "+JSON_FICHE.END+"/"+JSON_FICHE.Caractéristique.END+"</div>");
	var Prot_Tê = 0;
	var Prot_To = 0;
	var Prot_J = 0;
	var VE = 0;
	var Poids = 0;
if(JSON_FICHE.Inventaire.Armure != undefined){
	JSON_FICHE.Inventaire.Armure.forEach(function(e){
		e.Type.forEach(function(f){
			if(f == "Tête"){
        if(Prot_Tê == 0){
          Prot_Tê += Number(e.PA);
        }else{
          if(e.PA > Prot_Tê){var N = e.PA;var N1 = Prot_Tê;}else{var N = Prot_Tê;var N1 = e.PA;}
          var B = Superposition(Number(Number(N)-Number(N1)));
          Prot_Tê = Number(Number(N)+Number(B));
        }
      }
			if(f == "Torse"){
        if(Prot_To == 0){
          Prot_To += Number(e.PA);
        }else{
          if(e.PA > Prot_To){var N = e.PA;var N1 = Prot_To;}else{var N = Prot_To;var N1 = e.PA;}
          var B = Superposition(Number(Number(N)-Number(N1)));
          Prot_To = Number(Number(N)+Number(B));
        }
      }
			if(f == "Jambe"){
        if(Prot_J == 0){
          Prot_J += Number(e.PA);
        }else{
          if(e.PA > Prot_J){var N = e.PA;var N1 = Prot_J;}else{var N = Prot_J;var N1 = e.PA;}
          var B = Superposition(Number(Number(N)-Number(N1)));
          Prot_J = Number(Number(N)+Number(B));
        }
      }
		});
		VE += Number(e.VE);
		Poids += Number(e.Poids);
	});
}
function Superposition(e){
  if(e <= 4){
    return 5;
  }else if(e <= 8){
    return 4;
  }else if(e <= 14){
    return 3;
  }else if(e <= 20){
    return 2;
  }else{
    return 0;
  }
}
if(JSON_FICHE.Inventaire.Arme != undefined){
	JSON_FICHE.Inventaire.Arme.forEach(function(e){
		Poids += Number(e.Poids);
		$('#P4_Armes').append('<option value="'+e.Nom+'">'+e.Nom+'</option>');		
	});
}
if(JSON_FICHE.Inventaire.Autre != undefined){
	JSON_FICHE.Inventaire.Autre.forEach(function(e){Poids += Number(e.Poids);});
}
if(JSON_FICHE.Inventaire.Schéma != undefined){
	JSON_FICHE.Inventaire.Schéma.forEach(function(e){Poids += Number(e.Poids);});
}

$('#P4_Prot').append("<div>Tête: "+Prot_Tê+"</div>");
$('#P4_Prot').append("<div>Torse: "+Prot_To+"</div>");
$('#P4_Prot').append("<div>Jambes: "+Prot_J+"</div>");

$('#P4_EC').append("<div>Encombrement: "+Poids+"Kg /"+JSON_FICHE.Caractéristique.ENC+"</div>");
$('#P4_EC').append("<div>Encombrement d'armure: "+VE+"</div>");

if(JSON_FICHE.Bonus){
	if(JSON_FICHE.Bonus.Desc){$('#P4_Bonus').append(JSON_FICHE.Inventaire.Bonus.Desc);}
}
if(JSON_FICHE.Malus){
	if(JSON_FICHE.Malus.Desc){$('#P4_Malus').append(JSON_FICHE.Inventaire.Malus.Desc);}
}

function caract(){
$('#P4_Compt').empty().append('<option selected="selected" value="0">Aucune compétence</option>');
if(P4_Caract.value == "INT"){ // INT
  $('#P4_Compt')
  .append('<option value="Connaissance de la rue">Connaissance de la rue</option><option value="Connaissance des monstres">Connaissance des monstres</option><option value="Déduction">Déduction</option><option value="Éducation">Éducation</option><option value="Enseignement">Enseignement</option><option value="Étiquette">Étiquette</option><option value="Langue ancienne">Langue ancienne</option><option value="Langue commune">Langue commune</option><option value="Langue naine">Langue naine</option><option value="Négoce">Négoce</option><option value="Survie">Survie</option><option value="Tactique">Tactique</option><option value="Vigilance">Vigilance</option>');
}
if(P4_Caract.value == "REF"){ // REF
  $('#P4_Compt')
  .append('<option value="Bagarre">Bagarre</option><option value="Bâton/Lance">Bâton/Lance</option><option value="Équitation">Équitation</option><option value="Escrime">Escrime</option><option value="Esquive/Évasion">Esquive/Évasion</option><option value="Lames courtes">Lames courtes</option><option value="Mêlée">Mêlée</option><option value="Navigation">Navigation</option>');
}
if(P4_Caract.value == "DEX"){ // DEX
  $('#P4_Compt')
  .append('<option value="Adresse">Adresse</option><option value="Arbalète">Arbalète</option><option value="Archerie">Archerie</option><option value="Athlétisme">Athlétisme</option><option value="Furtivité">Furtivité</option>');
}
if(P4_Caract.value == "COR"){ // Corps
  $('#P4_Compt')
  .append('<option value="Physique">Physique</option><option value="Résilience">Résilience</option>');
}
if(P4_Caract.value == "EMP"){ // EMP
  $('#P4_Compt').append('<option value="Beaux-arts">Beaux-arts</option><option value="Charisme">Charisme</option><option value="Commandement">Commandement</option><option value="Duperie">Duperie</option><option value="Jeu">Jeu</option><option value="Persuasion">Persuasion</option><option value="Psychologie">Psychologie</option><option value="Représentation">Représentation</option><option value="Séduction">Séduction</option><option value="Stylisme">Stylisme</option>');
}
if(P4_Caract.value == "TEC"){ // TEC
  $('#P4_Compt').append('<option value="Alchimie">Alchimie</option><option value="Artisanat">Artisanat</option><option value="Contrefaçon">Contrefaçon</option><option value="Crochetage">Crochetage</option><option value="Déguisement">Déguisement</option><option value="Fabrication de pièges">Fabrication de pièges</option><option value="Premiers soins">Premiers soins</option>');
}
if(P4_Caract.value == "VOL"){ // VOL
  $('#P4_Compt')
  .append('<option value="Courage">Courage</option><option value="Envoûtement">Envoûtement</option><option value="Incantation">Incantation</option><option value="Intimidation">Intimidation</option><option value="Résistance à la contrainte">Résistance à la contrainte</option><option value="Résistance à la magie">Résistance à la magie</option><option value="Rituels">Rituels</option>');
}
if(P4_Caract.value == "10"){ // PRO
  JSON_FICHE.Compétences.forEach(function(e){
	if(e.P == "true"){
		$('#P4_Compt').append('<option value="'+e.Nom+'">'+e.Nom+'</option>');
	}
  });
}
}


effets();
</script>